/*! pubreader - v1.4.0 - 2017-12-22
* https://github.com/vanch3d/PubReader
* Copyright (c) 2017 ; Licensed  */

!function(e){e.jr||(e.jr=new Object),e.jr.utils||(e.jr.utils=new Object),Modernizr.addTest("boxflex",Modernizr.testAllProps("boxFlex")||Modernizr.testAllProps("flex"));var t=window.localStorage;e.extend(e.jr.utils,{touch:null,transitionEndEvName:{WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"}[Modernizr.prefixed("transition")],transformCssPropName:Modernizr.prefixed("transform"),columnGapCssPropName:Modernizr.prefixed("columnGap"),columnWidthCssPropName:Modernizr.prefixed("columnWidth"),columnCountCssPropName:Modernizr.prefixed("columnCount"),transitionDuration:Modernizr.prefixed("transitionDuration"),csstransitions:null!=Modernizr&&Boolean(Modernizr.csstransitions),csscolumns:null!=Modernizr&&Boolean(Modernizr.csscolumns),csstransforms3d:null!=Modernizr&&Boolean(Modernizr.csstransforms3d),ls:!!t}),e.extend(e.jr.utils,{transl2DPattern:"translateX(@px)",transl3DPattern:"translate3d(@px,0,0)",lsSet:function(e,n){if(t)try{t.removeItem(e),t.setItem(e,n)}catch(e){console.error(e.message)}},lsGet:function(e){if(t)try{var n=t.getItem(e);return JSON?/^(true|false|null)/.test(n)?JSON.parse(n):"undefined"===n?void 0:n:n}catch(e){console.error(e.message)}},jqSafeId:function(e){return"string"==typeof e?e.replace(/(:|\.)/g,"\\$1"):e},regexp:{escape:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}}})}(jQuery);var getActiveItemFromStore=function(e,t){var n=e.length,a=null;return[t,"default"].map(function(t){for(var r=0;r<n&&null==a;r++)e[r][t]&&(a=e[r].$el)}),a};!function(e){var t=[];e.fn.trackFip=function(n){var a=e.extend({},e.trackFip.defaults,n);return this.each(function(){var n=e(this),r=e.extend({},a,{$el:n});t.push(r),n.bind("show",function(e){r.active=!0}).bind("hide",function(e){r.active=!1}).bind("focusin",function(e){for(var n=0;n<t.length;n++)t[n].active=!1;r.active=!0})}),this},e.trackFip={defaults:{default:!1,active:!1,$el:null},active:function(){return getActiveItemFromStore(t,"active")}}}(jQuery),function(e){var t=[];e.fn.trackFocus=function(n){var a=e.extend({},e.trackFocus.defaults,n);return this.each(function(){var n=e(this),r=e.extend({},a,{$el:n});e.isNumeric(n.attr("tabindex"))||n.attr("tabindex",0),t.push(r),n.bind("focusin",function(e){for(var n=0;n<t.length;n++)t[n].focused=!1;r.focused=!0})}),this},e.trackFocus={defaults:{default:!1,focused:!1,$el:null},focused:function(){return getActiveItemFromStore(t,"focused")},refocus:function(){var t=e.trackFocus.focused();null!=t&&t.focus()}}}(jQuery),function(e){if(e.jr||(e.jr=new Object),"undefined"==typeof Modernizr)return console.error("jr.PageManager is dependent on Modernizr, which is not defined"),!1;var t=e(window),n=e(document),a=n.children(),r=e.jr.utils,o="jr:pm:go:next:page",i="jr:pm:go:prev:page",s="jr:pm:go:page",l="jr:pm:go:1st:page",c="jr:pm:go:last:page",p="jr:go:pos",u="jr:pm:page:turn:before",d="jr:pm:page:turn:after",f="jr:pm:pages:changed";e.jr.PageManager=function(g,h){var j=this;j.$el=e(g),j.el=g,j.$el.data("jr.PageManager",j),j.init=function(){return j.options=e.extend({},e.jr.PageManager.defaultOptions,h),j.contentPollingIntervalMin=j.contentPollingInterval=1e3,j.contentPollingIntervalMax=1024e3,j.contentPollingIntervalMul=2,j.$article=j.$el.find("> article").first(),1!==j.$article.length?(console.error("jr.PageManager was not able to find article's content"),!1):(j.article=j.$article.get(0),j.transXcurr=0,j.right=parseFloat(j.$el.css("right")),j.calcMetrics(),j.calcPages(),n.bind("keydown",j.kbdHandler),r.touch&&(j.$el.swipe({threshold:25,swipe:j.swipeHandler}),j.$el.bind("touchstart",j.tapHandler)),j.$el.scroll(j.scrollHandler),j.$el.bind(o,j.eventHandler),j.$el.bind(i,j.eventHandler),j.$el.bind(l,j.eventHandler),j.$el.bind(c,j.eventHandler),j.$el.bind(s,j.eventHandler),j.$el.bind(p,j.eventHandler),n.bind("jr:user:active click touchend",e.throttle(500,j.resetContentPollingInterval)),t.bind("resize",e.throttle(500,j.resetContentPollingInterval)),j.mw={deltaAcc:0,delta:0},j.$el.mousewheel(j.mousewheel),j.startPollingContentMetrics(),j.$el.trigger("show"),!0)},j.calcPages=function(){j.fPage(j.calcFPage()),j.cPage(j.calcCPage()),j.lPage(j.calcLPage()),j.pagesChanged()&&j.triggerPagesChanged()},j.fPage=function(t){var n=j._fp;return null!=n&&0!==n||(j._fp=j.calcFPage()),j._fp=e.isNumeric(t)?j._fp=parseInt(t):null!=j._fp?j._fp:0,n!==j._fp&&j.pagesChanged(!0),j._fp},j.lPage=function(t){var n=j._lp;return null!=n&&0!==n||(j._lp=j.calcLPage()),j._lp=e.isNumeric(t)?j._lp=parseInt(t):null!=j._lp?j._lp:0,n!==j._lp&&j.pagesChanged(!0),j._lp},j.cPage=function(t){var n=j._cp;return null!=n&&0!==n||(j._cp=j.calcCPage()),j._cp=e.isNumeric(t)?j._cp=parseInt(t):null!=j._cp?j._cp:0,n!==j._cp&&j.pagesChanged(!0),j._cp},j.pagesChanged=function(e){return"boolean"==typeof e&&(j._pChanged=e),j._pChanged},j._dumpPages=function(){console.info("_dumpPages(): fp=%s cp=%s lp=%s pChanged=%s",j._fp,j._cp,j._lp,j._pChanged)},j.calcFPage=function(){return j.contentWidth()>0?1:0},j.calcCPage=function(){var e=j.pxOffset2Page(j.contentPosLeft(),"r"),t=j.fPage(),n=j.lPage();return e<t?e=t:e>n&&(e=n),e},j.calcLPage=function(){return j.pxOffset2Page(j.contentWidth()-1,"f")},j.calcMetrics=function(){j.contentColumnGap(!0),j.contentPosLeft(!0),j.contentWidth(!0),j.pageWidth(!0)},j.contentColumnGap=function(e){var t=j._cg;return!0===e&&(j._cg=parseFloat(j.$article.css(r.columnGapCssPropName)),t!==j._cg&&j.metricsChanged(!0)),j._cg},j.contentPosLeft=function(e){j._pl;return!0===e&&(j.options.useTrans?j._pl=-j.$article.position().left:j._pl=j.el.scrollLeft),j._pl},j.contentWidth=function(e){var t=j._cw;if(!0===e){var n=j.article.scrollWidth;n>j.article.clientWidth?j._cw=n:(j.$article.css("overflow","hidden"),j._cw=j.article.scrollWidth,j.$article.css("overflow","visible")),t!==j._cw&&j.metricsChanged(!0)}return j._cw},j.pageWidth=function(e){var t=j._pw;return!0===e&&(j._pw=parseFloat(j.$article.innerWidth()+j.contentColumnGap(e)),t!==j._pw&&j.metricsChanged(!0)),j._pw},j.metricsChanged=function(e){return"boolean"==typeof e&&(j._mChanged=e),j._mChanged},j._dumpMetrics=function(){console.info("_dumpMetrics(): cgap=%s pleft=%s cwidth=%s pwidth=%s _mChanged=%s",j._cg,j._pl,j._cw,j._pw,j._mChanged)},j.nextPage=function(){var e=j.cPage();return e<j.lPage()?e+1:e},j.prevPage=function(){var e=j.cPage();return e>j.fPage()?e-1:e},j.cPage2OffsetInPP=function(t){var n=j.lPage(),a=e.isNumeric(t)?Math.min(n,Math.max(1,t)):j.cPage();return n>1?100*(a/n-.5/n):100},j.ppOffset2Page=function(e){var t=Math.min(100,Math.max(0,e)),n=j.lPage();return n>1&&(t=t*(1+1/n)-1/n),t=Math.max(0,t),n>1?Math.floor(t/100*n/(1+1/n))+1:1},j.pxOffset2Page=function(e,t){return null!=t&&"r"===t?Math.round(e/j.pageWidth())+1:Math.floor(e/j.pageWidth())+1},j.id2Page=function(t){var n,a,o;return null!=t&&""!==t&&(!/^#/.test(t)&&(t="#"+t),1===(o=e(r.jqSafeId(t))).length&&(a=o.position().left+j.contentPosLeft(!0),n=j.pxOffset2Page(a))),n},j.startPollingContentMetrics=function(){j.clearPollContentMetricsIntervalId(),j.pollContentMetricsIntervalId=setInterval(j.pollContentMetrics,j.contentPollingInterval),j.isPollingContentMetrics(!0)},j.stopPollingContentMetrics=function(){j.clearPollContentMetricsIntervalId(),j.isPollingContentMetrics(!1)},j.clearPollContentMetricsIntervalId=function(){e.isNumeric(j.pollContentMetricsIntervalId)&&(clearInterval(j.pollContentMetricsIntervalId),j.pollContentMetricsIntervalId=null)},j.resetContentPollingInterval=function(){j.contentPollingInterval!=j.contentPollingIntervalMin&&(j.contentPollingInterval=j.contentPollingIntervalMin,j.stopPollingContentMetrics(),j.startPollingContentMetrics())},j.isPollingContentMetrics=function(e){return"boolean"==typeof e?j._isPollingContentMetrics=e:j._isPollingContentMetrics},j.colW_colC_aW=function(){var t,n,a,o,i=j.$article,s=i.css(r.columnWidthCssPropName),l=i.css(r.columnCountCssPropName),c=i.css(r.columnGapCssPropName),p=i.innerWidth(),u=parseFloat(c);return"auto"===l&&"auto"!==s?(t=parseFloat(s),o=Math.floor((p+u)/(t+u))):e.isNumeric(l)&&(o=l),e.isNumeric(o)?(t=(p+u)/o-u,a=(p+u)/o-Math.floor(u/2),n=(p+u)/o,{cw:t,cwg:n,cwhg:a,cc:o,cg:u,aw:p,cssCW:s,cssCC:l}):void 0},j.adjustContentRightSide=function(){var e,t=parseFloat(j.$el.css("right")),n=t-j.right,a=j.colW_colC_aW();null!=a&&(e=(a.aw+n)%a.cc+a.cg%a.cc),null!=e&&j.right+e!==t&&j.$el.css("right",j.right+e)},j.pollContentMetrics=function(){if(j.adjustContentRightSide(),0!==j.el.scrollLeft&&j.$el.scrollLeft(0),0!==j.el.scrollTop&&j.$el.scrollTop(0),j.isPollingContentMetrics()&&(j.calcMetrics(),j.metricsChanged())){var e=j.cPage2OffsetInPP();j.calcPages(),j.goPage(j.ppOffset2Page(e)),j.metricsChanged(!1)}j.contentPollingInterval<=j.contentPollingIntervalMax&&(j.contentPollingInterval*=j.contentPollingIntervalMul,j.stopPollingContentMetrics(),j.startPollingContentMetrics())},j.triggerPageTurnBefore=function(){j.$el.trigger(u,{pn:j.cPage(),po:j.cPage2OffsetInPP(),lp:j.lPage()})},j.triggerPageTurnAfter=function(){j.$el.trigger(d,{pn:j.cPage(),po:j.cPage2OffsetInPP(),lp:j.lPage()}),j.pagesChanged(!1)},j.triggerPagesChanged=function(){j.$el.trigger(f,{pn:j.cPage(),po:j.cPage2OffsetInPP().toPrecision(6),lp:j.lPage()}),j.resetContentPollingInterval()},j.goNextPage=function(){j.goPage(j.nextPage())},j.goPrevPage=function(){j.goPage(j.prevPage())},j.goFirstPage=function(){j.goPage(j.fPage())},j.goLastPage=function(){j.goPage(j.lPage())},j.goPage=function(t){var n=j.cPage(),o=j.metricsChanged(),i=j.pagesChanged(),s=j.pageWidth();if(!0===e.isNumeric(t)&&t>=j.fPage()&&t<=j.lPage()&&(!0===o||t!==n)){var l=Math.floor(parseFloat(t));if(o||i||l!==n)if(j.triggerPageTurnBefore(),j.stopPollingContentMetrics(),j.transX=s*(l-1),j.transX!=j.transXcurr)if(j.options.useTrans){var c=parseFloat(j.$article.css(r.transitionDuration))>0;c&&(j.$article.unbind(r.transitionEndEvName),j.$article.one(r.transitionEndEvName,j.transitionEnd)),j.cPage(l),j.pagesChanged()&&j.triggerPagesChanged();var p=r.csstransforms3d&&a.hasClass("animate")?r.transl3DPattern:r.transl2DPattern;j.$article.css(r.transformCssPropName,p.replace(/@/g,-j.transX)),j.transXcurr=j.transX,!c&&j.transitionEnd()}else j.$el.stop(!0,!0),j.$el.animate({scrollLeft:j.transX},250,j.transitionEnd);else j.startPollingContentMetrics()}},j.transitionEnd=function(e){j.triggerPageTurnAfter(),j.startPollingContentMetrics()},j.swipeHandler=function(e,t,n,a){var r=!1;"left"==t?(j.goNextPage(),r=!0):"right"==t&&(j.goPrevPage(),r=!0),r&&e.preventDefault()},j.clickHandler=function(t){if("click"===t.type){var n=e(t.currentTarget),a=(t.clientX-n.position().left)/n.innerWidth();a<=.2?j.goPrevPage():a>=.8&&j.goNextPage()}return!1},j.tapHandler=function(e){if(null==j._touch&&(j.$el.unbind("click",j.clickHandler),j._touch=!0),"touchstart"===e.type&&(j.$el.bind("touchend touchmove touchcancel",j.tapHandler),j._touches=e.originalEvent.targetTouches.length,j._pageX=e.originalEvent.targetTouches[0].pageX),"touchmove"!==e.type&&"touchcancel"!==e.type||(j._pageX=null),"touchend"===e.type&&null!=j._pageX){var t=j._pageX;_oW=j.$el.outerWidth(),_lbW=parseFloat(j.$el.css("border-left-width")),_rbW=parseFloat(j.$el.css("border-right-width")),_touchX=t-j.$el.position().left,_touchX<_lbW?j.goPrevPage():_oW-_touchX<_rbW&&j.goNextPage(),j._pageX=null}return"touchend"!==e.type&&"touchcancel"!==e.type||j.$el.unbind("touchend touchmove touchcancel",j.tapHandler),!0},j.kbdHandler=function(t){var n=t.keyCode,a=e(t.target);0==j.$el.closest(a).length&&0==a.closest(j.$el).length||(9===n?t.preventDefault():38===n||37===n||33===n?j.goPrevPage():40===n||39===n||34===n?j.goNextPage():35===n?j.goLastPage():36===n&&j.goFirstPage())},j.eventHandler=function(t,n){var a=t.type;e.isPlainObject(n)||(n={pn:j.fPage()}),a===o?j.goNextPage():a===i?j.goPrevPage():a===l?j.goFirstPage():a===c?j.goLastPage():a===s&&e.isNumeric(parseFloat(n.pn))?j.goPage(parseFloat(n.pn)):a===s&&e.isNumeric(parseFloat(n.po))?j.goPage(j.ppOffset2Page(parseFloat(n.po))):a===s&&e.isNumeric(parseFloat(n.px))?j.goPage(j.pxOffset2Page(parseFloat(n.px+j.contentPosLeft(!0)))):a===s&&"string"==typeof n.id&&""!==n.id?j.goPage(j.id2Page(n.id)):a===p&&null!=n.pos&&e.isNumeric(parseFloat(n.pos.left))&&j.goPage(j.pxOffset2Page(parseFloat(n.pos.left+j.contentPosLeft(!0))))},j.scrollHandler=function(e){e.preventDefault();e.type;if(0!==j.el.scrollLeft){var t=window.location.hash;null!=t&&""!==t&&(j.$el.unbind("scroll",j.scrollHandler),j.stopPollingContentMetrics(),j.calcMetrics(),j.$el.scrollLeft(0),j.goPage(j.id2Page(t)),j.$el.bind("scroll",j.scrollHandler),j.startPollingContentMetrics())}return!1},j.mousewheel=function(e,t,n,a){for((j.mw.delta>0&&t<0||j.mw.delta<0&&t>0)&&(j.mw.deltaAcc=0),j.mw.deltaAcc-=t;j.mw.deltaAcc>=1;)j.goNextPage(),j.mw.deltaAcc--;for(;j.mw.deltaAcc<=-1;)j.goPrevPage(),j.mw.deltaAcc++;j.mw.delta=t},j.init()},e.jr.PageManager.defaultOptions={useTrans:!0},e.fn.jr_PageManager=function(t){return this.each(function(){new e.jr.PageManager(this,t)})},e.fn.getjr_PageManager=function(){return this.data("jr.PageManager")}}(jQuery),function(e){e.jr||(e.jr=new Object),e.jr.PaginationStatus=function(t,n){var a=this;a.$el=e(t),a.el=t,null!=n.poc?(a.$el.data("jr.PaginationStatus",a),a.init=function(){a.options=e.extend({},e.jr.PaginationStatus.defaultOptions,n),a.$poc=e(a.options.poc),a.$poc.bind("jr:pm:pages:changed",a.eventHandler)},a.eventHandler=function(t,n){if(!e.isPlainObject(n))return!0;return"jr:pm:pages:changed"===t.type&&(a.$el.find(".jr-pg-pn").html(n.pn),a.$el.find(".jr-pg-lp").html(n.lp),a.$el.find(".jr-pg-po").html(Math.floor(n.po))),!0},a.init()):console.error("PaginationStatus: point of communication (poc) was not provided")},e.jr.PaginationStatus.defaultOptions={},e.fn.jr_PaginationStatus=function(t){return this.each(function(){new e.jr.PaginationStatus(this,t)})},e.fn.getjr_PaginationStatus=function(){return this.data("jr.PaginationStatus")}}(jQuery),function(e){e.jr||(e.jr=new Object);var t=e.jr.utils;e.jr.PageTurnSensor=function(n,a){var r=this;null!=a.poc?null!=a.action?null!=a.actionEv?null!=a.piEv?(r.$el=e(n),r.el=n,null!=a.poc&&(r.$el.data("jr.PageTurnSensor",r),r.clickEvName=t.touch?"touchend":"click",r.init=function(){r.options=e.extend({},e.jr.PageTurnSensor.defaultOptions,a),r.$poc=e(r.options.poc),r.$el.bind(r.clickEvName,r.clickHandler),r.$poc.bind(r.options.piEv,r.piHandler)},r.clickHandler=function(e){null!=r.options.actionEv&&r.$poc.trigger(r.options.actionEv)},r.piHandler=function(t,n){t.type;return!e.isPlainObject(n)||(null!=n.pn&&null!=n.lp&&("prev"===r.options.action||"first"===r.options.action?1===n.pn?r.$el.addClass("hidden"):r.$el.removeClass("hidden"):"next"!==r.options.action&&"last"!==r.options.action||(n.pn===n.lp?r.$el.addClass("hidden"):r.$el.removeClass("hidden"))),!0)},r.init())):console.error("PageTurnSensor: piEv is not provided"):console.error("PageTurnSensor: actionEv is not provided"):console.error("PageTurnSensor: action is not provided"):console.error("PageTurnSensor: Point Of Content (poc) with Page Manager is not provided")},e.jr.PageTurnSensor.defaultOptions={action:"next",poc:null},e.fn.jr_PageTurnSensor=function(t){return this.each(function(){new e.jr.PageTurnSensor(this,t)})},e.fn.getjr_PageTurnSensor=function(){return this.data("jr.PageTurnSensor")}}(jQuery),function(e){e.jr||(e.jr={}),e.jr.PageProgressBar=function(t,n){function a(){var e=l.lastPageManEvent;e.found&&(s(e.maxpage,e.pagenum,e.offset),l.lastPageManEvent.found=!1)}function r(){}function o(e,t){if(void 0!==t){var n=l.lastEvent,a=l.rangeinput.getConf().max;if(!n||n.source!=u||n.max!=a||!isNaN(t)&&n.value!=t){n.source=p,n.max=a,n.value=t;var r=jQuery.Event("jr:pm:go:page",{originalEvent:e});l.$poc.trigger(r,{pn:t})}else n.source=p}else l.rangeinput.setValue(l.$input.val())}function i(t,n){if(!e.isPlainObject(n))return!0;if("jr:pm:pages:changed"===t.type&&null!==n.pn&&null!==n.lp){var a=l.lastEvent;a&&a.source===p&&a.max==n.lp&&a.value==n.pn?a.source=u:"none"!=c.css("display")?s(n.lp,n.pn,n.po):(l.lastPageManEvent.found=!0,l.lastPageManEvent.maxpage=n.lp,l.lastPageManEvent.pagenum=n.pn,l.lastPageManEvent.offset=n.po),l.$pageNumSpan.text(n.pn),l.$lastPageSpan.text(n.lp),l.$percentSpan.text(Math.floor(n.po)+"%")}return!0}function s(e,t,n){var a=l.lastEvent;a.source=u,a.max=e,a.value=t,l.rangeinput.setRange(void 0,e,t)}var l=this;l.el=t;var c=l.$el=e(t);if(c.data("jr.PageProgressBar",l),null!==n.poc){var p=0,u=1;l.init=function(){l.options=e.extend({},e.jr.PageProgressBar.defaultOptions,n),l.$poc=e(l.options.poc),l.$poc.bind("jr:pm:pages:changed",i),l.visible=!1;var t=l.$input=c.html('<div class="pr-text">  <span class="pr-np"></span> of <span class="pr-lp"></span></div><input type="range" />').children("input").rangeinput({css:{slider:"pr-slider",input:"pr-pn",handle:"pr-handle",progress:""},min:1,max:50,value:10,step:1,progress:!1});t.hide();var s=c.children(".pr-text");s.hide(),s.prepend(t),l.rangeinput=l.$input.data("rangeinput"),l.$pageNumSpan=s.children(".pr-np"),l.$lastPageSpan=s.children(".pr-lp"),l.$percentSpan=s.children(".pr-pct"),l.lastEvent={source:-1,max:50,value:-1},l.lastPageManEvent={found:!1,maxpage:50,pagenum:-1,offset:0},t.change(o),c.bind("jr:panel:hide:after",r),c.bind("jr:panel:show:after",a)},l.init()}else console.error("PageProgressBar: point of communication (poc) was not provided")},e.jr.PageProgressBar.defaultOptions={},e.fn.jr_PageProgressBar=function(t){return this.each(function(){new e.jr.PageProgressBar(this,t)})},e.fn.getjr_PageProgressBar=function(){return this.data("jr.PageProgressBar")}}(jQuery),function(e){e.jr||(e.jr={});var t=e.jr.utils;e.jr.Links=function(n,a){var r=this;null!==a.poc?(r.$el=e(n),r.el=n,r.$el.data("jr.Links",r),r.init=function(){r.options=e.extend({},e.jr.Links.defaultOptions,a),r.$el.prop("onclick",null),r.$el.removeAttr("onclick target"),r.$el.attr("href",r.modHrefForRepObjOnly(r.$el.attr("href"))),/^#/.test(r.$el.attr("href"))||r.$el.attr("target","_blank"),r.$poc=e(r.options.poc),r.$el.bind(t.touch?"touchend":"click",r.clickHandler)},r.clickHandler=function(t){var n=e(this).attr("href"),a=e(this).attr("target");return"click"!==t.type&&"touchend"!==t.type||r.$poc.trigger("jr:hk:mark:hp"),"touchend"===t.type&&null==a&&null!=n&&(window.location=n),!0},r.modHrefForRepObjOnly=function(e){function t(e,t){var n=e.split("#"),a="report="+t;return/\?/.test(n[0])?n[0]+="&"+a:n[0]+="?"+a,n.join("#")}return/\breport=/.test(e)||(/\/(table|figure)\//.test(e)?e=t(e,"objectonly"):/\/articles\/.*\/(cited|pdf|epub|bin)/.test(e)||/\/articles\//.test(e)&&(e=t(e,"reader"))),e},r.init()):console.error("Links: point of communication (poc) was not provided")},e.jr.Links.defaultOptions={},e.fn.jr_Links=function(t){return this.each(function(){new e.jr.Links(this,t)})},e.fn.getjr_Links=function(){return this.data("jr.Links")}}(jQuery),function(e){e.jr||(e.jr=new Object);var t="jr:hk:mark:hp";e.jr.HistoryKeeper=function(n,a){var r=this;r.$el=e(n),r.el=n,r.$el.data("jr.HistoryKeeper",r),r.init=function(){r.options=e.extend({},e.jr.HistoryKeeper.defaultOptions,a),window.addEventListener("hashchange",r.hashchangeHandler),r.$el.bind(t,r.eventHandler),r.$el.bind("jr:pm:pages:changed",r.eventHandler),r.hashchangeHandler()},r.hashchangeHandler=function(t){var n=window.location.hash,a=e.Event("jr:pm:go:page",{originalEvent:t});if(/^#!po=/.test(n)){var o=parseFloat(n.slice(5));r.$el.trigger(a,{po:o})}else/^#/.test(n)&&r.$el.trigger(a,{id:n})},r.eventHandler=function(e,n){e.preventDefault();var a=e.type;return a===t&&null!=r._po?window.location.hash!=="#!po="+r._po&&history.pushState(null,null,"#!po="+r._po):"jr:pm:pages:changed"===a&&(r._po=n.po),!0},r.init()},e.jr.HistoryKeeper.defaultOptions={},e.fn.jr_HistoryKeeper=function(t){return this.each(function(){new e.jr.HistoryKeeper(this,t)})},e.fn.getjr_HistoryKeeper=function(){return this.data("jr.HistoryKeeper")}}(jQuery),function(e){function t(t){e.jr.ObjectBox.OB.blur().addClass("hidden").trigger("hide"),e.jr.ObjectBox.clean()}e.jr||(e.jr={});var n=e.jr.utils,a=e.jr.utils.touch;e.jr.ObjectBox=function(t,n){var r=this,o=e(t);r.el=t,r.$el=o,o.data("jr.ObjectBox",r),r.init=function(){var t=r.options=e.extend({},e.jr.ObjectBox.defaultOptions,n),a=r.$el;if(a.on((t.handleClick?"click.jr-ob ":"")+"open",function(e){return t.preventDefault&&e.preventDefault(),a.is(".jr-objectbox-trigger")||r.open(),!t.preventDefault}),!t.href&&a.attr("data-href")&&(t.href=a.attr("data-href")),!t.path&&a.attr("data-path")&&(t.path=a.attr("data-path")),1==t.focusOnOpen){var o=e(t.focusOnOpenElement);e.isNumeric(o.attr("tabindex"))||o.attr("tabindex","0")}},r.open=function(){var t=r.options,n=r.$el;if(e.jr.ObjectBox.OB.is(":visible")&&e.jr.ObjectBox.clean(),n.addClass("jr-objectbox-trigger"),""!==t.objectBoxClass&&e.jr.ObjectBox.OB.addClass(t.objectBoxClass).data("objectBoxClass",t.objectBoxClass),t.contentLocal){var o=""!=t.contentId?"#"+t.contentId:t.contentLocalAttrPrefix+n.attr(t.contentLocalAttr);e(o).clone(!0).removeAttr("id").removeClass("hidden").find("[id]").removeAttr("id").end().find("img[data-src]").each(function(){var t=e(this);t.attr("src",t.attr("data-src"))}).end().appendTo(e.jr.ObjectBox.OB.find(".jr-objectbox-drawer"))}else{var i=e.jr.ObjectBox.OB.find(".jr-objectbox-drawer");i.load(t.href,function(){i.find("img[data-src]").each(function(){var n=e(this);n.attr("src",n.attr("data-src").replace(/\{\$path\}/g,t.path))}).end()})}e.jr.ObjectBox.open({o:t}),e("#jr-content").on(a?"touchend.jr-ob":"click.jr-ob",function(){e.jr.ObjectBox.close()})},r.init()},e.jr.ObjectBox.clean=function(){if(e.jr.ObjectBox.OB.find(".title-text").text("").end().find(".jr-objectbox-drawer").empty(),e(".jr-objectbox-trigger").length){var t=e(".jr-objectbox-trigger"),n=t.data("jr.ObjectBox").options.objectBoxClass;""!==n&&e.jr.ObjectBox.OB.removeClass(n),t.removeClass("jr-objectbox-trigger")}},e.jr.ObjectBox.close=function(){e.jr.ObjectBox.OB.addClass("thidden");parseFloat(e.jr.ObjectBox.OB.css(n.transitionDuration))>0?e.jr.ObjectBox.OB.one(n.transitionEndEvName,t):setTimeout(t,50),e("#jr-content").off("click.jr-ob touchend.jr-ob"),e(".jr-objectbox-drawer").data("refLength",""),e.jr.ObjectBox.OB.trigger("ObjectBoxClose"),e(document).unbind("keydown",e.jr.ObjectBox.kbdHandler),e.jr.ObjectBox.OB.unbind("jr:go:pos")},e.jr.ObjectBox.defaultOptions={contentLocal:!1,contentId:"",contentLocalAttr:"rid",contentLocalAttrPrefix:"#",focusOnOpen:!0,focusOnOpenElement:"#jr-objectbox",objectBoxClass:"",handleClick:!0,href:"",path:"",preventDefault:"true"},e.jr.ObjectBox.open=function(t){function a(){e.jr.ObjectBox.OB.find(".jr-objectbox-drawer").find(".ncbimedia").ncbimedia()}function r(){e.jr.ObjectBox.OB.trigger("show"),setTimeout(function(){e.jr.ObjectBox.OB.focus()},100),a()}if(e.jr.ObjectBox.OB.is(":visible"))a();else{null!=t.o&&1==t.o.focusOnOpen&&e(t.o.focusOnOpenElement),e.jr.ObjectBox.OB.removeClass("hidden").trigger("ObjectBoxOpen"),setTimeout(function(){e.jr.ObjectBox.OB.removeClass("thidden")},50),transFlag=parseFloat(e.jr.ObjectBox.OB.css(n.transitionDuration))>0,transFlag?e.jr.ObjectBox.OB.one(n.transitionEndEvName,r):setTimeout(r,50),e(document).bind("keydown",e.jr.ObjectBox.kbdHandler),e.jr.ObjectBox.OB.bind("jr:go:pos",e.jr.ObjectBox.goPosHandler)}},e.jr.ObjectBox.kbdHandler=function(t){var n=e(t.target),a=e.jr.ObjectBox.OB;0==n.closest(a).length&&0==a.closest(n).length||27==t.keyCode&&e.jr.ObjectBox.close()},e.jr.ObjectBox.goPosHandler=function(t,n){e.isPlainObject(n)||(n={pos:{left:0,top:0}});var a=e.jr.ObjectBox.OB.find(".jr-objectbox-drawer"),r=a.scrollTop(),o=a.scrollLeft(),i=a.innerHeight(),s=a.innerWidth();a.stop().animate({scrollTop:r+n.pos.top-i/2,scrollLeft:o+n.pos.left-s/2})},e.jr.ObjectBox.OB=e("#jr-objectbox"),e.fn.jr_ObjectBox=function(t){return this.each(function(){new e.jr.ObjectBox(this,t)})},e.fn.getjr_ObjectBox=function(){return this.data("jr.ObjectBox")},e(".jr-objectbox-close").on(a?"touchend.jr-ob":"click.jr-ob",function(t){return t.preventDefault(),t.stopPropagation(),e.jr.ObjectBox.close(),!1}),e(".pr-pn").change(function(){e.jr.ObjectBox.OB.is(":visible")&&e.jr.ObjectBox.close()})}(jQuery),function(e){e.jr||(e.jr=new Object);var t=e.jr.utils,n="jr:switch:on:before",a="jr:switch:on",r="jr:switch:on:stateless",o="jr:switch:on:after",i="jr:switch:off:before",s="jr:switch:off",l="jr:switch:off:stateless",c="jr:switch:off:after";e.jr.Switcher=function(p,u){var d=this;d.$el=e(p),d.el=p,d.$el.data("jr.Switcher",d),d.clickEvName=t.touch?"touchend":"click",d.init=function(){d.options=e.extend({},e.jr.Switcher.defaultOptions,u),d.$poc=e(d.options.poc),d.type=d.options.type,d.autoOff=d.options.autoOff,d.stateless=!1;var n=t.lsGet("state_"+d.$el.attr("id"));d.options.state=null!=n?n:d.options.state,"boolean"!=typeof d.options.state&&(d.options.state=e.jr.Switcher.defaultOptions.state),"boolean"!=typeof d.autoOff&&(d.autoOff=d.options.autoOff=e.jr.Switcher.defaultOptions.autoOff),"radio"!==d.type&&"chkbox"!==d.type&&(d.type=d.options.type=e.jr.Switcher.defaultOptions.type),d.$el.bind(d.clickEvName,d.clickHandler),d.$el.bind(a,d.turnOnHandler),d.$el.bind(r,d.turnOnHandler),d.options.state&&d.$el.trigger(a),d.$el.removeClass("hidden")},d.toggleSwitch=function(){d.state?(d.$poc.unbind(o,d.turnOffHandler),d.$poc.unbind(s,d.turnOffHandler),d.$poc.unbind(l,d.turnOffHandler),d.$poc.trigger(i),d.$el.trigger(i),d.state=!d.state,d.$el.removeClass("on"),d.autoOff&&(e(document).unbind(d.clickEvName,d.turnOffHandler),e(document).unbind("show.canvas",d.turnOffHandler)),d.$poc.trigger(c),d.$el.trigger(c)):(d.$poc.trigger(n),d.$el.trigger(n),d.state=!d.state,d.$el.addClass("on"),d.$el.bind(s,d.turnOffHandler),d.$el.bind(l,d.turnOffHandler),d.autoOff&&(e(document).bind(d.clickEvName,d.turnOffHandler),e(document).bind("show.canvas",d.turnOffHandler)),d.$poc.trigger(o),d.$el.trigger(o),"radio"===d.type&&d.$poc.bind(o,d.turnOffHandler)),d.stateless||t.lsSet("state_"+d.$el.attr("id"),d.state)},d.turnOnHandler=function(e){d.stateless=e.type===r,d.state||d.toggleSwitch()},d.turnOffHandler=function(e){d.stateless=e.type===l,d.state&&d.toggleSwitch()},d.clickHandler=function(e){e.stopPropagation(),d.toggleSwitch()},d.init()},e.jr.Switcher.defaultOptions={state:!1,type:"radio",poc:null,autoOff:!0},e.fn.jr_Switcher=function(t){return this.each(function(){new e.jr.Switcher(this,t)})},e.fn.getjr_Switcher=function(){return this.data("jr.Switcher")}}(jQuery),function(e){e.jr||(e.jr=new Object);var t=e.jr.utils,n=e(document),a="jr:panel:show",r="jr:panel:show:stateless",o="jr:panel:hide",i="jr:panel:hide:stateless",s="jr:panel:show:after",l="jr:panel:hide:after";e.jr.Panel=function(c,p){var u=this;u.$el=e(c),u.el=c,u.$el.data("jr.Panel",u),u.init=function(){u.options=e.extend({},e.jr.Panel.defaultOptions,p),u.$poc=e(u.options.poc),u.clickEvName=t.touch?"touchend":"click",u.$el.bind(a,u.showHandler),u.$el.bind(r,u.showHandler),u.$el.bind(o,u.hideHandler),u.$el.bind(i,u.hideHandler),u.$el.bind(u.clickEvName,u.clickHandler),u.$poc.bind("jr:switch:on:after",u.options.inverted?u.hideHandler:u.showHandler),u.$poc.bind("jr:switch:off:before",u.options.inverted?u.showHandler:u.hideHandler),u.$el.find(".jr-p-close").bind(u.clickEvName,u.hideHandler)},u.clickHandler=function(e){!(u.options.propogateClick||"click"!==e.type&&"touchend"!==e.type)&&e.stopPropagation(),n.trigger("jr:user:active")},u.hideHandler=function(e){e.type===o||e.type===u.clickEvName?u.$poc.trigger("jr:switch:off"):e.type===i?u.$poc.trigger("jr:switch:off:stateless"):(u.$el.addClass("hidden"),u.$el.trigger(l))},u.showHandler=function(e){e.type===a?u.$poc.trigger("jr:switch:on"):e.type===r?u.$poc.trigger("jr:switch:on:stateless"):(u.$el.removeClass("hidden"),u.$el.trigger(s))},u.init()},e.jr.Panel.defaultOptions={poc:null,propogateClick:!1,inverted:!1},e.fn.jr_Panel=function(t){return this.each(function(){new e.jr.Panel(this,t)})},e.fn.getjr_Panel=function(){return this.data("jr.Panel")}}(jQuery),function(e){e.jr||(e.jr=new Object);var t=e.jr.utils,n=["jr-fs-7","jr-fs-8","jr-fs-9","jr-fs-10","jr-fs-11","jr-fs-12","jr-fs-13","jr-fs-14","jr-fs-15","jr-fs-18","jr-fs-21","jr-fs-24"],a=["jr-col-auto","jr-col-1","jr-col-2"],r=["animate","no-animate"],o={"jr-col-auto":"$colAuto","jr-col-1":"$col1","jr-col-2":"$col2"},i={animate:"$animYes","no-animate":"$animNo"};e.jr.PanelTypo=function(s,l){var c=this;c.$el=e(s),c.el=s,c.$el.data("jr.PanelTypo",c),c.clickEvName=t.touch?"touchend":"click",c.init=function(){c.options=e.extend({},e.jr.PanelTypo.defaultOptions,l),c.$fontSmaller=c.$el.find(".sf"),c.$fontLarger=c.$el.find(".lf"),c.$colAuto=c.$el.find(".bcol-auto"),c.$col1=c.$el.find(".bcol-1"),c.$col2=c.$el.find(".bcol-2"),c.$animYes=c.$el.find(".anim-yes"),c.$animNo=c.$el.find(".anim-no"),c.initProp(n,"fontSizeClassName"),c.initProp(a,"colCountClassName"),c.initProp(r,"animateClassName"),c.setupButtons(o,"colCountClassName",!0),c.setupButtons(i,"animateClassName",!0),c.$fontSmaller.bind(c.clickEvName,c.handleFontSmaller),c.$fontLarger.bind(c.clickEvName,c.handleFontLarger),c.$colAuto.bind(c.clickEvName,c.handleColAuto),c.$col1.bind(c.clickEvName,c.handleCol1),c.$col2.bind(c.clickEvName,c.handleCol2),c.$animYes.bind(c.clickEvName,c.handleAnimYes),c.$animNo.bind(c.clickEvName,c.handleAnimNo)},c.value2Idx=function(t,n){var a,r=null;if("string"==typeof n&&e.isArray(t))for(a=0;a<t.length;a++)0===n.localeCompare(t[a])&&(r=a);return r},c.initProp=function(n,a){var r=t.lsGet(a);return null==c.value2Idx(n,r)&&(null!=c.value2Idx(n,c.options[a])?r=c.options[a]:null!=e.jr.PanelTypo.defaultOptions[a]&&(r=e.jr.PanelTypo.defaultOptions[a])),c[a]=r},c.prevFontSizeClassName=function(e){var t=c.value2Idx(n,e);return null!=t?n[t-1]:null},c.nextFontSizeClassName=function(e){var t=c.value2Idx(n,e);return null!=t?n[t+1]:null},c.handleFontSmaller=function(n){var a=c.fontSizeClassName,r=c.prevFontSizeClassName(a);null!=r&&(t.lsSet("fontSizeClassName",c.fontSizeClassName=r),e("html").removeClass(a).addClass(r))},c.handleFontLarger=function(n){var a=c.fontSizeClassName,r=c.nextFontSizeClassName(a);null!=r&&(t.lsSet("fontSizeClassName",c.fontSizeClassName=r),e("html").removeClass(a).addClass(r))},c.setupButtons=function(n,a,r){var o=c[a];!0===r?(c[n[o]].addClass("on"),e("html").addClass(o),t.lsSet(a,o)):(c[n[o]].removeClass("on"),e("html").removeClass(o))},c.activateButton=function(e,t,n){c.setupButtons(e,t,!1),c[t]=n,c.setupButtons(e,t,!0)},c.handleColAuto=function(e){c.activateButton(o,"colCountClassName","jr-col-auto")},c.handleCol1=function(e){c.activateButton(o,"colCountClassName","jr-col-1")},c.handleCol2=function(e){c.activateButton(o,"colCountClassName","jr-col-2")},c.handleAnimYes=function(e){c.activateButton(i,"animateClassName","animate")},c.handleAnimNo=function(e){c.activateButton(i,"animateClassName","no-animate")},c.init()},e.jr.PanelTypo.defaultOptions={fontSizeClassName:"jr-fs-13",colCountClassName:"jr-col-auto",animateClassName:"no-animate"},e.fn.jr_PanelTypo=function(t){return this.each(function(){new e.jr.PanelTypo(this,t)})},e.fn.getjr_PanelTypo=function(){return this.data("jr.PanelTypo")}}(jQuery),function(e){e.jr||(e.jr=new Object),e.jr.PanelCmap=function(t,n){var a=this;a.$el=e(t),a.el=t,a.$el.data("jr.PanelCmap",a),a.init=function(){a.options=e.extend({},e.jr.PanelCmap.defaultOptions,n),a.$poc=e(a.options.poc),a.mapList=e("article :header[id]"),a.$cnt=a.$el.find(".cnt"),1==a.$cnt.length&&a.mapList.each(function(){var t=e(this),n=t.attr("id"),r=parseInt(t[0].nodeName.substring(1),10),o=t.contents().clone();e('<a href="#'+n+'"></a>').on("click",a.handleLinks).append(o).attr("title",o[0].data).attr("class","lvl"+r).data("rid",n).attr("style",t.attr("style")).appendTo(a.$cnt)}),a.$poc.bind("jr:pm:pages:changed",e.throttle(1e3,a.pagesChangedHandler))},a.pagesChangedHandler=function(e,t){"jr:pm:pages:changed"===e.type&&(null==a.pm&&(a.pm=a.$poc.getjr_PageManager()),a.pi=t,a.updateMapHighliting())},a.updateMapHighliting=function(){a.$cnt.children().each(function(){var t=e(this);t.data("page",a.pm.id2Page(t.data("rid")))}),a.$cnt.children().each(function(){var t=e(this),n=t.next();t.data("page")<=a.pi.pn&&(0===n.length||a.pi.pn<n.data("page")||t.data("page")==a.pi.pn&&t.data("page")==n.data("page"))?t.addClass("current"):t.removeClass("current")})},a.closePanel=function(e){return null!=e&&e.preventDefault(),a.$el.trigger("jr:panel:hide"),!1},a.handleLinks=function(t){window.location.hash="";e(this);return a.closePanel(),!0},a.init()},e.jr.PanelCmap.defaultOptions={poc:null},e.fn.jr_PanelCmap=function(t){return this.each(function(){new e.jr.PanelCmap(this,t)})},e.fn.getjr_PanelCmap=function(){return this.data("jr.PanelCmap")}}(jQuery),function(e){e.jr||(e.jr=new Object);var t=e.jr.utils,n=e(document).children(),a="jr:is:go:next:page",r="jr:is:go:prev:page",o="jr:is:pages:changed";e.jr.PanelIstrip=function(i,s){var l=this;l.$el=e(i),l.el=i,l.$el.data("jr.PanelIstrip",l),l.init=function(){if(l.options=e.extend({},e.jr.PanelIstrip.defaultOptions,s),l.$style=e('<style type="text/css"/>'),l.$panevp=e('<div class="panevp"/>'),l.$pane=e('<div class="pane"/>'),!e.isNumeric(l.minM=parseFloat(l.options.minM))&&(l.minM=e.jr.PanelIstrip.defaultOptions.minM),l.fts=e("article").find(".fig[id] img.small-thumb, .table-wrap[id] img.small-thumb"),0!==l.fts.length){var n=t.touch;if(l.fts.each(function(t){var a=e(this),r=a.parent().closest("*[id]"),o=r.find("a").first(),i=r.attr("id"),s=a.clone(),c=e("<a/>").css({"background-image":"url("+s.attr("src")+")"}).attr("rid",i).attr("rid-figpopup",i).attr("co-class","co-fig");!n&&c.on("click",l.handleObjectBox),c.attr("title",null!=s.attr("alt")?s.attr("alt"):null!=s.attr("title")?s.attr("title"):"").attr("rid",i),null!=o.attr("href")&&c.attr("href",o.attr("href")),l.$pane.append(c)}),l.$itm=l.$pane.children().first(),e("head").append(l.$style),l.$el.append(l.$panevp.append(l.$pane)),l.pi={fp:0,lp:0,cp:0,changed:!1},e(document).bind("keydown",l.kbdHandler),e(window).bind("resize",l.handleResize),l.$el.bind("jr:panel:show:after",l.Reflow),l.$el.bind(a,l.handleNextPage),l.$el.bind(r,l.handlePrevPage),n&&l.$el.swipe({threshold:25,swipeLeft:l.handleNextPage,swipeRight:l.handlePrevPage}),null!=e.fn.figPopup){var o=new e.fn.figPopup,i=l.$pane.find("a");i.popupSensor({statIfLonger:500,delayIn:o.delayIn,delayOut:o.delayOut,touchable:n}),e.fn.hoverIntent&&!n&&i.hoverIntent(o)}l.flowItems()}else l.$el.trigger("jr:panel:hide:stateless")},l.flowItems=function(){l.arrangeMargin(),l.calcPages()},l.calcMetrics=function(){var e=l.$panevp,t=e.get(0),n=l.$pane,a=l.$itm;l.$pane_m={iw:e.innerWidth(),sw:t.scrollWidth+-n.position().left,pl:n.position().left},l.$itm_m={ow:a.outerWidth()}},l.arrangeMargin=function(){l.$panevp.css({width:"auto",display:"block"}),l.calcMetrics();var e=l.$pane_m.iw,t=l.$itm_m.ow,n=Math.floor(e/(t+2*l.minM)),a=Math.round((e-t*n)/n/2);iwpaneFixed=(t+2*a)*Math.floor(e/(t+2*a)),iwpaneFixed>0&&l.$panevp.css({width:iwpaneFixed,display:"block"}),l.$pane.children().css({marginLeft:a.toPrecision(4)+"px",marginRight:a.toPrecision(4)+"px"})},l.calcPages=function(){l.fPage(l.calcFPage()),l.lPage(l.calcLPage()),l.cPage(l.calcCPage()),l.pagesChanged()&&l.triggerPagesChanged()},l.makePageFunc=function(t,n){return function(a){var r=l.pi[t];return null!=r&&0!==r||(l.pi[t]=l[n]()),l.pi[t]=e.isNumeric(a)?parseInt(a):null!=l.pi[t]?l.pi[t]:0,r!==l.pi[t]&&l.pagesChanged(!0),l.pi[t]}},l.fPage=l.makePageFunc("fp","calcFPage"),l.lPage=l.makePageFunc("lp","calcLPage"),l.cPage=l.makePageFunc("cp","calcCPage"),l.pagesChanged=function(e){return"boolean"==typeof e&&(l.pi.changed=e),l.pi.changed},l.calcFPage=function(){return 1},l.calcCPage=function(){var e=l.pxOffset2Page(l.contentPosLeft(),"r"),t=l.fPage(),n=l.lPage();return e<t?e=t:e>n&&(e=n),e},l.calcLPage=function(){return l.pxOffset2Page(l.contentWidth()-1,"f")},l.pxOffset2Page=function(e,t){return null!=t&&"r"===t?Math.round(e/l.pageWidth())+1:Math.floor(e/l.pageWidth())+1},l.pageWidth=function(){return l.$pane_m.iw=l.$panevp.innerWidth()},l.contentWidth=function(){return l.$pane_m.sw=l.$panevp.get(0).scrollWidth+-l.$pane.position().left},l.contentPosLeft=function(){return l.$pane_m.pl=-l.$pane.position().left},l.triggerPagesChanged=function(){l.$el.trigger(o,{pn:l.cPage(),lp:l.lPage()})},l.nextPage=function(){var e=l.cPage();return e<l.lPage()?e+1:e},l.prevPage=function(){var e=l.cPage();return e>l.fPage()?e-1:e},l.goNextPage=function(){l.goPage(l.nextPage())},l.goPrevPage=function(){l.goPage(l.prevPage())},l.Reflow=function(){l.flowItems(),l.goPage(l.calcCPage())},l.goPage=function(a){if(!0===e.isNumeric(a)&&a>=l.fPage()&&a<=l.lPage()){var r=l.pageWidth(),o=Math.floor(parseFloat(a)),i=t.csstransforms3d&&n.hasClass("animate")?t.transl3DPattern:t.transl2DPattern;l.$pane.css(t.transformCssPropName,i.replace(/@/g,-r*(o-1))),l.cPage(o),l.pagesChanged()&&l.triggerPagesChanged()}},l.handleObjectBox=function(n){if(null!=n){n.preventDefault();if((a=e(this)).trigger("mouse.out.sensor"),!t.touch||"click"!==n.type){var a=e(this);e("#"+a.attr("rid")).find("a").first().trigger("open")}}},l.handleNextPage=function(e){return null!=e&&e.preventDefault(),l.goNextPage(),!1},l.handlePrevPage=function(e){return null!=e&&e.preventDefault(),l.goPrevPage(),!1},l.handleResize=function(t){e.isNumeric(l.ReflowTimerId)&&clearTimeout(l.ReflowTimerId),l.ReflowTimerId=setTimeout(l.Reflow,1e3)},l.kbdHandler=function(e){var t=e.keyCode;188===t?l.goPrevPage():190===t&&l.goNextPage()},l.init()},e.jr.PanelIstrip.defaultOptions={minM:5},e.fn.jr_PanelIstrip=function(t){return this.each(function(){new e.jr.PanelIstrip(this,t)})},e.fn.getjr_PanelIstrip=function(){return this.data("jr.PanelIstrip")}}(jQuery),function($){$.jr||($.jr=new Object);var $u=$.jr.utils,$doc=$(document),state={UNDEFIND:-1,HIDDEN:0,EXPOSED:1};$.jr.Fip=function(el,options){var base=this;base.$el=$(el),base.el=el,base.$el.data("jr.Fip",base),base.init=function(){base.options=$.extend({},$.jr.Fip.defaultOptions,options),base.fipTargets=base.options.fipTargets,base.state=state.UNDEFIND,base.$mgB=base.$el.find("#jr-fip-mg"),base.$doneB=base.$el.find("#jr-fip-done"),base.$nextB=base.$el.find("#jr-fip-next"),base.$prevB=base.$el.find("#jr-fip-prev"),base.$termF=base.$el.find("#jr-fip-term"),base.$matchesP=base.$el.find("#jr-fip-matches"),$doc.bind("keydown",base.docKDHandler),base.$mgB.bind("click",base.mgClkHandler),base.$doneB.bind("click",base.doneClkHandler),base.$nextB.bind("click",base.nextClkHandler),base.$prevB.bind("click",base.prevClkHandler),base.$termF.bind("keyup",base.termKUHandler),base.state=state.HIDDEN,base.$el.bind("focusin",base.focusInHandler),base.$el.bind("jr:fip:show",base.showHandler),base.$el.bind("jr:fip:hide",base.hideHandler),base.resetCounters()},base.docKDHandler=function(e){var t=e.keyCode,n=e.ctrlKey||e.metaKey,a=e.shiftKey,r=$(e.target),o=base.$el;n&&70===t?(e.preventDefault(),base.exposeUI()):base.state==state.EXPOSED&&(27==t?r.closest(o).length+o.closest(r).length>0&&base.hideUI():(n&&71==t||114==t)&&(a?base.prevClkHandler(e):base.nextClkHandler(e)))},base.exposeUI=function(){base.fipTargets.length>0&&(base.state!=state.EXPOSED&&(base.$el.removeClass("hidden"),base.state=state.EXPOSED,base.term=""),base.$termF.focus().select())},base.hideUI=function(){base.state==state.EXPOSED&&(base.cleanMarks(),base.$el.addClass("hidden"),base.state=state.HIDDEN,$.trackFocus.refocus())},base.showHandler=function(e){base.exposeUI()},base.hideHandler=function(e){base.hideUI()},base.focusInHandler=function(e){base.setFipTagetPoc()},base.setFipTagetPoc=function(){var e=$.trackFip.active();base.fipMarkTotal>0&&e.get(0)!=base.$active.get(0)&&base.cleanMarks(),base.$poc=null,base.$fipTarget=null,base.$active=e,base.term="",$.each(base.fipTargets,function(t,n){var a=$(n.fipTarget),r=$(n.poc);return 1!=a.length||1!=r.length||!(e.closest(a).length>0||a.closest(e).length>0)||(base.$poc=r,base.$fipTarget=a,!1)})},base.doneClkHandler=function(e){e.preventDefault(),base.hideUI()},base.nextClkHandler=function(e){e.preventDefault(),base.npClkStep(1)},base.prevClkHandler=function(e){e.preventDefault(),base.npClkStep(-1)},base.npClkStep=function(step){with(base)if(fipMarkTotal>0){removeActiveMark(),fipMarkCurrent+=step;var c=fipMarkCurrent,t=fipMarkTotal;fipMarkCurrent=c<0?t-1:c>=t?0:c,updateMatches(),setActiveMark()}},base.termKUHandler=function(e){var kc=e.keyCode,ks=e.shiftKey;with(base)13==kc&&(findExec()||(ks?prevClkHandler(e):nextClkHandler(e)))},base.mgClkHandler=function(e){e.preventDefault(),base.findExec()||base.nextClkHandler(e)},base.getTermVal=function(){return base.$termF.val().trim()},base.findExec=function(){base.$termF.select();var e=base.getTermVal();return e.length>0&&e!=base.term&&(base.cleanMarks(),base.find(e),!0)},base.find=function(e){if($u.touch&&base.$termF.blur(),base.$fipTarget instanceof jQuery){base.$fipTarget.is(":visible")||$.trackFocus.refocus();var t=base.term=e.toLowerCase(),n=new RegExp("("+$u.regexp.escape(t)+")","gi");if(_found=base.$fipTarget.find(":not(iframe,script)").contents().filter(function(){return 3==this.nodeType&&this.nodeValue.match(/\S/)}).filter(function(){var e=$(this);return this.nodeValue.toLowerCase().indexOf(t)>=0&&window.getComputedStyle(e.parent()[0]).opacity>0&&(e.replaceWith(this.nodeValue.replace(n,'<span class="fip_mark">$1</span>')),!0)}),_found.length>0){base.fipMarks=base.$fipTarget.find("span.fip_mark"),base.fipMarkTotal=base.fipMarks.length,base.fipMarkCurrent=0;for(var a=0;a<base.fipMarks.length;a++){var r=base.positionInArticle($(base.fipMarks[a]));if(r.left>0&&r.top>0){base.fipMarkCurrent=a;break}}base.npClkStep(0)}}},base.removeActiveMark=function(){$(base.fipMarks.get(base.fipMarkCurrent)).removeClass("fip_active")},base.setActiveMark=function(){var e=$(base.fipMarks.get(base.fipMarkCurrent)).addClass("fip_active"),t=base.positionInArticle(e),n=$.Event("jr:go:pos");base.$poc.trigger(n,{pos:t})},base.cleanMarks=function(){base.fipMarkTotal>0&&base.$fipTarget.find("span.fip_mark").each(function(){with(this.parentNode)replaceChild(this.firstChild,this),normalize()}),base.resetCounters(),base.updateMatches()},base.positionInArticle=function(e){if(e instanceof jQuery){var t=(e=e.first()).position(),n=e.parentsUntil("article");e.attr("class");return n.map(function(){var e=$(this);if("static"!=e.css("position")){e.attr("class");var n=e.position();t.left+=n.left,t.top+=n.top}}),t}return null},base.updateMatches=function(){with(base){var t=fipMarkTotal;$matchesP.text(0==t?"no matches":fipMarkCurrent+1+" of "+t+" match"+(t>1?"es":""))}},base.resetCounters=function(){with(base)fipMarkCurrent=0,fipMarkTotal=0,fipMarks=[]},base.init()},$.jr.Fip.defaultOptions={fipTargets:[]},$.fn.jr_Fip=function(e){return this.each(function(){new $.jr.Fip(this,e)})},$.fn.getjr_Fip=function(){return this.data("jr.Fip")}}(jQuery),function(e){if(!e.console){var t=e.console={};t.log=t.error=t.info=t.debug=t.warn=t.trace=t.dir=t.dirxml=t.group=t.groupEnd=t.time=t.timeEnd=t.assert=t.profile=t.profileEnd=function(){}}}(window),jQuery(document).ready(function(){function e(e){null!=e&&null!=e.each&&e.each(function(){var e=this,t=$(this);$.each(["top","bottom"],function(n,a){e.style[a]="",t.css(a,Math.floor(parseFloat(t.css(a))))})})}var t=$.jr.utils,n=(window.location.href,$("#jr-content"));try{if(t.csscolumns){$("#jr-ui").removeClass("hidden");var a=$("#jr-content");e(a),$(window).resize($.throttle(500,function(t){e(a)}));try{$("body").trackFocus()}catch(e){console.error(e.message)}try{$("#jr-pi").jr_PaginationStatus({poc:"#jr-content"}).removeClass("hidden")}catch(e){console.error(e.message)}try{t.touch||($("#jr-pm-left").jr_PageTurnSensor({action:"prev",actionEv:"jr:pm:go:prev:page",piEv:"jr:pm:pages:changed",poc:"#jr-content"}),$("#jr-pm-right").jr_PageTurnSensor({action:"next",actionEv:"jr:pm:go:next:page",piEv:"jr:pm:pages:changed",poc:"#jr-content"}),$("#jr-pi-prev").jr_PageTurnSensor({action:"prev",actionEv:"jr:pm:go:prev:page",piEv:"jr:pm:pages:changed",poc:"#jr-content"}),$("#jr-pi-next").jr_PageTurnSensor({action:"next",actionEv:"jr:pm:go:next:page",piEv:"jr:pm:pages:changed",poc:"#jr-content"}))}catch(e){console.error(e.message)}try{$("#jr-progress").jr_PageProgressBar({poc:"#jr-content"}).jr_Panel({poc:"#jr-is-sw",inverted:!0,propogateClick:!0})}catch(e){console.error(e.message)}try{$("#jr-istrip").jr_Panel({poc:"#jr-is-sw",propogateClick:!0}),$("#jr-is-sw").jr_Switcher({poc:"#jr-dash",state:!0,autoOff:!1}),$("#jr-is-prev").jr_PageTurnSensor({action:"prev",actionEv:"jr:is:go:prev:page",piEv:"jr:is:pages:changed",poc:"#jr-istrip"}),$("#jr-is-next").jr_PageTurnSensor({action:"next",actionEv:"jr:is:go:next:page",piEv:"jr:is:pages:changed",poc:"#jr-istrip"}),$("#jr-istrip").jr_PanelIstrip()}catch(e){console.error(e.message)}try{var r=$("article a").jr_Links({poc:"#jr-content"});t.touch&&r.filter(".bibr,.figpopup,.icnblk_cntnt a").removeAttr("href"),$(document).on("click","a",function(){var e=$(this),t=e.attr("href");null!=e.data("jr.Links")||null==t||""===t&&"#"===t||$("#jr-content").trigger("jr:hk:mark:hp")})}catch(e){console.error(e.message)}try{$("#jr-links-p").trackFocus().jr_Panel({poc:"#jr-links-sw"}),$("#jr-links-sw").jr_Switcher({poc:"#jr-head"})}catch(e){console.error(e.message)}try{$("#jr-alt-p").trackFocus().jr_Panel({poc:"#jr-alt-sw"}),$("#jr-alt-sw").jr_Switcher({poc:"#jr-head"})}catch(e){console.error(e.message)}try{$("#jr-cmap-p").trackFocus().jr_Panel({poc:"#jr-cmap-sw"}),$("#jr-cmap-p").jr_PanelCmap({poc:"#jr-content"}),$("#jr-cmap-sw").jr_Switcher({poc:"#jr-head"})}catch(e){console.error(e.message)}try{$("#jr-typo-p").trackFocus().jr_Panel({poc:"#jr-typo-sw"}),$("#jr-typo-p").jr_PanelTypo(),$("#jr-typo-sw").jr_Switcher({poc:"#jr-head"})}catch(e){console.error(e.message)}try{$("#jr-content").trackFocus().trackFip({default:!0}).jr_PageManager()}catch(e){console.error(e.message)}try{$("#jr-content").jr_HistoryKeeper()}catch(e){console.error(e.message)}try{$("#jr-fip").trackFocus().jr_Fip({fipTargets:[{fipTarget:"#jr-content article[data-type=main]",poc:"#jr-content"},{fipTarget:"#jr-objectbox article",poc:"#jr-objectbox"}]}),$("#jr-fip-sw").bind("click",function(){$("#jr-fip").trigger("jr:fip:show"),$("#jr-help-p").trigger("jr:panel:hide")}).removeClass("hidden")}catch(e){console.error(e.message)}try{$("#jr-objectbox").trackFocus().trackFip(),$("#jr-content").find(".figpopup, .icnblk_cntnt a").jr_ObjectBox({handleClick:!t.touch,contentLocal:!0,contentLocalAttr:"rid-ob"})}catch(e){console.error(e.message)}try{$("#jr-help-p").trackFocus().jr_Panel({poc:"#jr-help-sw"}),$("#jr-help-sw").jr_Switcher({poc:"#jr-head"}),$("#jr-about-sw").jr_ObjectBox({objectBoxClass:"about"}),$("#jr-helpobj-sw").jr_ObjectBox({objectBoxClass:"help"}),$("#jr-about-sw,#jr-helpobj-sw").on("click",function(){$("#jr-help-p").trigger("jr:panel:hide")})}catch(e){console.error(e.message)}try{var o=new jQuery.fn.figPopup,i=(r=jQuery("a.figpopup"),jQuery("a.bibr"));r.each(function(){$(this).attr("co-class","co-fig")}),i.each(function(){var e=$(this);e.attr("co-class","co-refbox").attr("co-rid",e.attr("rid"))}),r.popupSensor({statIfLonger:500,delayIn:o.delayIn,delayOut:o.delayOut,touchable:t.touch}),i.popupSensor({statIfLonger:500,delayIn:o.delayIn,delayOut:o.delayOut,touchable:t.touch}),t.touch||(r.hoverIntent(o),i.hoverIntent(o))}catch(e){console.error(e.message)}}else console.error("Your browser is not supported. HTML5/CSS3 and ECMAScript, 5th Edition, CSS Multicolumn layout features are required."),n.trigger("jr:util:unsupported-browser")}catch(e){console.error(e.message)}});
//# sourceMappingURL=pubreader.min.js.map